<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Famms CMS - Netlify CMS</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Netlify CMS -->
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
    
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .cms-header {
            background: linear-gradient(135deg, var(--primary-color), #34495e);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .cms-header h1 {
            margin: 0;
            font-weight: bold;
        }
        
        .cms-header .btn {
            background-color: var(--secondary-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .cms-header .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .cms-container {
            margin-top: 30px;
            margin-bottom: 50px;
        }
        
        .cms-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        
        .cms-card:hover {
            transform: translateY(-5px);
        }
        
        .cms-card h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .cms-card .feature-icon {
            font-size: 3rem;
            color: var(--secondary-color);
            margin-bottom: 20px;
        }
        
        .cms-loading {
            text-align: center;
            padding: 50px;
        }
        
        .cms-loading i {
            font-size: 3rem;
            color: var(--secondary-color);
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .cms-error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .cms-success {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- CMS Header -->
    <div class="cms-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-cms me-2"></i>Famms CMS</h1>
                    <p class="mb-0">Content Management System</p>
                </div>
                <div>
                    <button class="btn btn-light" onclick="goToAdmin()">
                        <i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard
                    </button>
                    <button class="btn btn-light ms-2" onclick="goToSite()">
                        <i class="fas fa-eye me-2"></i>View Site
                    </button>
                    <button class="btn btn-warning ms-2" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CMS Container -->
    <div class="container cms-container">
        <!-- Loading State -->
        <div id="cmsLoading" class="cms-loading">
            <i class="fas fa-spinner"></i>
            <h3 class="mt-3">Loading CMS...</h3>
            <p class="text-muted">Please wait while we initialize the content management system</p>
        </div>

        <!-- CMS Content -->
        <div id="cmsContent" class="hidden">
            <div class="row">
                <div class="col-md-4">
                    <div class="cms-card">
                        <div class="feature-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h3>Home Page</h3>
                        <p>Manage hero section, arrivals, and call-to-action elements</p>
                        <button class="btn btn-primary" onclick="editPage('index')">
                            <i class="fas fa-edit me-2"></i>Edit Home Page
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="cms-card">
                        <div class="feature-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <h3>About Page</h3>
                        <p>Edit story, gallery, and company information</p>
                        <button class="btn btn-primary" onclick="editPage('about')">
                            <i class="fas fa-edit me-2"></i>Edit About Page
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="cms-card">
                        <div class="feature-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <h3>Contact Page</h3>
                        <p>Configure contact form and communication details</p>
                        <button class="btn btn-primary" onclick="editPage('contact')">
                            <i class="fas fa-edit me-2"></i>Edit Contact Page
                        </button>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <div class="cms-card">
                        <div class="feature-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <h3>Products</h3>
                        <p>Add, edit, and manage product catalog</p>
                        <button class="btn btn-success" onclick="manageCollection('products')">
                            <i class="fas fa-cog me-2"></i>Manage Products
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="cms-card">
                        <div class="feature-icon">
                            <i class="fas fa-images"></i>
                        </div>
                        <h3>Gallery</h3>
                        <p>Manage photo gallery and images</p>
                        <button class="btn btn-success" onclick="manageCollection('gallery')">
                            <i class="fas fa-cog me-2"></i>Manage Gallery
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="cms-card">
                        <div class="feature-icon">
                            <i class="fas fa-quote-left"></i>
                        </div>
                        <h3>Testimonials</h3>
                        <p>Manage customer testimonials and reviews</p>
                        <button class="btn btn-success" onclick="manageCollection('testimonials')">
                            <i class="fas fa-cog me-2"></i>Manage Testimonials
                        </button>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="cms-card">
                        <div class="feature-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <h3>Site Settings</h3>
                        <p>Configure general settings, social media, and contact information</p>
                        <button class="btn btn-warning" onclick="editPage('settings')">
                            <i class="fas fa-edit me-2"></i>Edit Settings
                        </button>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="cms-card">
                        <div class="feature-icon">
                            <i class="fas fa-code"></i>
                        </div>
                        <h3>Advanced CMS</h3>
                        <p>Access full Netlify CMS interface for advanced editing</p>
                        <button class="btn btn-dark" onclick="openFullCMS()">
                            <i class="fas fa-external-link-alt me-2"></i>Open Full CMS
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div id="cmsError" class="cms-error hidden">
            <h4><i class="fas fa-exclamation-triangle me-2"></i>CMS Loading Error</h4>
            <p>Unable to load the Content Management System. Please ensure you're logged in with Netlify Identity.</p>
            <button class="btn btn-primary" onclick="login()">
                <i class="fas fa-sign-in-alt me-2"></i>Login with Netlify
            </button>
        </div>
    </div>

    <!-- CMS Container (Hidden, for Netlify CMS) -->
    <div id="cms-container" class="hidden"></div>

    <script>
        // Navigation Functions
        function goToAdmin() {
            window.location.href = 'index.html';
        }

        function goToSite() {
            window.location.href = '../index.html';
        }

        function login() {
            if (window.netlifyIdentity) {
                window.netlifyIdentity.open();
            } else {
                console.error('Netlify Identity not loaded');
                showError();
            }
        }

        function logout() {
            if (window.netlifyIdentity) {
                window.netlifyIdentity.logout();
            }
        }

        // CMS Functions
        function editPage(page) {
            if (window.CMS) {
                window.CMS.navigateToCollection(page);
            } else {
                openFullCMS();
            }
        }

        function manageCollection(collection) {
            if (window.CMS) {
                window.CMS.navigateToCollection(collection);
            } else {
                openFullCMS();
            }
        }

        function openFullCMS() {
            // Initialize and open full Netlify CMS
            if (window.CMS) {
                document.getElementById('cms-container').classList.remove('hidden');
                document.getElementById('cmsContent').classList.add('hidden');
                document.getElementById('cmsLoading').classList.add('hidden');
                document.getElementById('cmsError').classList.add('hidden');
            } else {
                showError();
            }
        }

        function showContent() {
            document.getElementById('cmsLoading').classList.add('hidden');
            document.getElementById('cmsContent').classList.remove('hidden');
            document.getElementById('cmsError').classList.add('hidden');
        }

        function showError() {
            document.getElementById('cmsLoading').classList.add('hidden');
            document.getElementById('cmsContent').classList.add('hidden');
            document.getElementById('cmsError').classList.remove('hidden');
        }

        // Initialize Netlify CMS and Identity
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            if (window.netlifyIdentity) {
                window.netlifyIdentity.on('init', user => {
                    if (!user) {
                        // User not logged in, redirect to login
                        window.netlifyIdentity.on('login', () => {
                            showContent();
                            initializeCMS();
                        });
                        login();
                    } else {
                        // User is logged in
                        showContent();
                        initializeCMS();
                    }
                });

                window.netlifyIdentity.on('logout', () => {
                    window.location.href = 'index.html';
                });
            } else {
                console.error('Netlify Identity not loaded');
                showError();
            }
        });

        function initializeCMS() {
            // Initialize Netlify CMS with manual configuration
            if (window.CMS && !window.CMS.config) {
                window.CMS_MANUAL_INIT = true;
                
                // Load CMS configuration
                fetch('cms-config.yml')
                    .then(response => response.text())
                    .then(yaml => {
                        // Parse YAML (simplified - in production, use a YAML parser)
                        const config = {
                            backend: {
                                name: 'git-gateway',
                                branch: 'main'
                            },
                            media_folder: "images/uploads",
                            public_folder: "/images/uploads",
                            publish_mode: 'editorial_workflow',
                            site_url: 'https://promo200.netlify.app',
                            display_url: 'https://promo200.netlify.app'
                        };
                        
                        window.CMS.init({ config: config });
                    })
                    .catch(error => {
                        console.error('Error loading CMS config:', error);
                        showError();
                    });
            }
        }
    </script>
</body>
</html>
